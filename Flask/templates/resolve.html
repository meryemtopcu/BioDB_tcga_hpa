{# ============================================================================================================
  resolve.html (extends base.html)

  WHY THIS PAGE EXISTS:
  - Users search by gene SYMBOL (e.g., TP53, U3).
  - A symbol is not always a unique key in real datasets.
  - The same symbol can map to multiple stable identifiers (e.g., Ensembl Gene IDs).
  - Therefore: we "resolve" ambiguity by presenting candidate gene_ids.

  INPUTS FROM FLASK:
  - gene_name   : the symbol user typed
  - candidates  : list of tuples like:
        c[0] = gene_id (Ensembl)
        c[1] = gene_name (symbol)
    Example:
        ("ENSG00000141510", "TP53")

  OUTPUT / NAVIGATION:
  - User clicks "View results" -> /results/<gene_id> (or /results?gene_id=...)
============================================================================================================ #}

{% extends "base.html" %}
{% block title %}Resolve Gene â€“ My BioDB{% endblock %}

{% block content %}

<div class="my-4">

  <!-- ==========================================================================================
       1) PAGE TITLE + EXPLANATION
       - Sets user expectations: ambiguity is normal, not an error.
       ========================================================================================== -->
  <div class="card mb-4">
    <div class="card-body">
      <h1 class="h5 mb-2">Resolve gene symbol</h1>

      <p class="mb-2 text-muted">
        The symbol <strong>{{ gene_name }}</strong> maps to multiple stable gene identifiers
        (e.g., Ensembl Gene IDs). Select one Gene ID to open the integrated results page.
      </p>

      <div class="alert alert-info mb-0" role="alert">
        <strong>Why can results be empty?</strong>
        Some Gene IDs may have no rows in TCGA and/or no matching entry in HPA in this specific database snapshot.
        If a results page looks empty, try another Gene ID from the list.
      </div>
    </div>
  </div>

  <!-- ==========================================================================================
       2) CANDIDATES TABLE
       - Each row is one possible mapping (gene_name -> gene_id).
       - Action button links to results endpoint with the selected gene_id.
       ========================================================================================== -->
  <div class="card">
    <div class="card-header">
      Candidates
    </div>

    <div class="card-body">

      {% if candidates|length == 0 %}
        <!-- No candidates: show a clear fallback message -->
        <div class="alert alert-warning mb-0" role="alert">
          No gene IDs found for symbol <strong>{{ gene_name }}</strong>.
          Try a different symbol or check spelling.
        </div>
      {% else %}

        <div class="table-responsive">
          <table class="table table-bordered table-sm mb-0">
            <thead class="thead-light">
              <tr>
                <th>Gene symbol</th>
                <th>Gene ID (Ensembl)</th>
                <th style="width: 140px;">Action</th>
              </tr>
            </thead>

            <tbody>
              {% for c in candidates %}
              <tr>
                <td>{{ c[1] }}</td>
                <td><code>{{ c[0] }}</code></td>
                <td>
                  <a class="btn btn-sm btn-primary"
                     href="{{ url_for('results', gene_id=c[0]) }}">
                    View results
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>

          </table>
        </div>

        <div class="mt-3">
          <a href="/" class="btn btn-sm btn-outline-secondary">Back to home</a>
        </div>

      {% endif %}

    </div>
  </div>

</div>

{% endblock %}
